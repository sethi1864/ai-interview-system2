<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Conferencing Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .warning { border-left: 4px solid #FF9800; }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        .video-test {
            width: 100%;
            height: 300px;
            background: #000;
            border-radius: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎥 Video Conferencing System Verification</h1>
        <p>This page verifies that all video conferencing features are working correctly.</p>
        
        <div class="test-item success">
            <h3>✅ Server Status</h3>
            <p>Server is running and serving the new video conferencing interface.</p>
            <div id="server-status">Checking...</div>
        </div>
        
        <div class="test-item">
            <h3>📹 Camera & Microphone Test</h3>
            <p>Test your camera and microphone access:</p>
            <button onclick="testMedia()">Test Camera & Microphone</button>
            <video id="test-video" class="video-test" autoplay muted></video>
            <div id="media-status">Click button to test</div>
        </div>
        
        <div class="test-item">
            <h3>🎤 Speech Recognition Test</h3>
            <p>Test speech recognition functionality:</p>
            <button onclick="testSpeechRecognition()">Test Speech Recognition</button>
            <div id="speech-status">Click button to test</div>
            <div id="speech-result" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; margin-top: 10px;"></div>
        </div>
        
        <div class="test-item">
            <h3>🔊 Text-to-Speech Test</h3>
            <p>Test text-to-speech functionality:</p>
            <button onclick="testTTS()">Test Text-to-Speech</button>
            <div id="tts-status">Click button to test</div>
        </div>
        
        <div class="test-item">
            <h3>🤖 Avatar System Test</h3>
            <p>Test AI avatar rendering:</p>
            <button onclick="testAvatar()">Test Avatar</button>
            <div id="avatar-container" style="width: 200px; height: 200px; background: #333; border-radius: 10px; margin: 10px 0;"></div>
            <div id="avatar-status">Click button to test</div>
        </div>
        
        <div class="test-item">
            <h3>🌐 WebSocket Test</h3>
            <p>Test real-time communication:</p>
            <button onclick="testWebSocket()">Test WebSocket</button>
            <div id="websocket-status">Click button to test</div>
        </div>
        
        <div class="test-item success">
            <h3>🚀 Ready to Start Interview</h3>
            <p>If all tests pass, you're ready to start your video interview!</p>
            <button onclick="startInterview()" style="background: #2196F3;">🎬 Start Video Interview</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/avatar.js?v=1.0"></script>
    <script>
        // Test server status
        async function testServer() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                document.getElementById('server-status').innerHTML = 
                    `✅ Server is healthy<br>Active Interviews: ${data.activeInterviews}<br>Active Connections: ${data.activeConnections}`;
            } catch (error) {
                document.getElementById('server-status').innerHTML = `❌ Server error: ${error.message}`;
            }
        }
        
        // Test media devices
        async function testMedia() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const video = document.getElementById('test-video');
                video.srcObject = stream;
                document.getElementById('media-status').innerHTML = '✅ Camera and microphone working!';
            } catch (error) {
                document.getElementById('media-status').innerHTML = `❌ Media error: ${error.message}`;
            }
        }
        
        // Test speech recognition
        function testSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'en-US';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    document.getElementById('speech-status').innerHTML = '🎤 Listening... Speak now!';
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('speech-result').innerHTML = `You said: "${transcript}"`;
                    document.getElementById('speech-status').innerHTML = '✅ Speech recognition working!';
                };
                
                recognition.onerror = (event) => {
                    document.getElementById('speech-status').innerHTML = `❌ Speech error: ${event.error}`;
                };
                
                recognition.start();
            } else {
                document.getElementById('speech-status').innerHTML = '❌ Speech recognition not supported';
            }
        }
        
        // Test text-to-speech
        function testTTS() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance('Hello! This is a test of the text-to-speech system.');
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                
                utterance.onstart = () => {
                    document.getElementById('tts-status').innerHTML = '🔊 Speaking...';
                };
                
                utterance.onend = () => {
                    document.getElementById('tts-status').innerHTML = '✅ Text-to-speech working!';
                };
                
                utterance.onerror = (event) => {
                    document.getElementById('tts-status').innerHTML = `❌ TTS error: ${event.error}`;
                };
                
                window.speechSynthesis.speak(utterance);
            } else {
                document.getElementById('tts-status').innerHTML = '❌ Text-to-speech not supported';
            }
        }
        
        // Test avatar
        function testAvatar() {
            try {
                const avatar = new AIAvatar('avatar-container');
                document.getElementById('avatar-status').innerHTML = '✅ Avatar system working!';
                
                // Test speaking animation
                setTimeout(() => {
                    avatar.startSpeaking();
                    setTimeout(() => {
                        avatar.stopSpeaking();
                    }, 2000);
                }, 1000);
            } catch (error) {
                document.getElementById('avatar-status').innerHTML = `❌ Avatar error: ${error.message}`;
            }
        }
        
        // Test WebSocket
        function testWebSocket() {
            try {
                const socket = io();
                
                socket.on('connect', () => {
                    document.getElementById('websocket-status').innerHTML = '✅ WebSocket connected!';
                    socket.disconnect();
                });
                
                socket.on('disconnect', () => {
                    document.getElementById('websocket-status').innerHTML = '✅ WebSocket test completed!';
                });
                
                socket.on('connect_error', (error) => {
                    document.getElementById('websocket-status').innerHTML = `❌ WebSocket error: ${error.message}`;
                });
            } catch (error) {
                document.getElementById('websocket-status').innerHTML = `❌ WebSocket error: ${error.message}`;
            }
        }
        
        // Start interview
        function startInterview() {
            window.location.href = '/';
        }
        
        // Run initial tests
        window.addEventListener('load', () => {
            testServer();
        });
    </script>
</body>
</html>